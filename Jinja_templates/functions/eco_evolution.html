{% extends 'functions/base.html' %}

<!-- ---------------------------------------------------------------------------------------------------- -->

{% block title %} 社会经济演化分析系统 {% endblock %}

<!-- ---------------------------------------------------------------------------------------------------- -->

{% block stylesheets %}
    <link rel="stylesheet" href="{{ static('plg/sweetalert.css') }}">
    <link rel="stylesheet" href="{{ static('plg/bootstrap-3.4.1-dist/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ static('plg/font-awesome-4.7.0/css/font-awesome.min.css') }}">
    <style>
        body {
            background: #337ab7;
        }

        h5 {
            color: #d4d1d1;
        }

        label {
            font-weight: 300;
        }

        .fa {
            margin-left: 8px;
        }

        .text-blue {
            color: #153974 !important;
            font-weight: 500;
            font-size: 1.6rem;
        }

        #A_container, #B_container, #C_container, #D_container {
            position: relative;
            box-shadow: 0 0 10px 5px rgba(75, 145, 173, 0.44);
            padding: 10px;
            border-radius: 9px;
        }

        .form-select {
            width: 100px;
            position: absolute;
            top: 10px;
            right: 25px;
            z-index: 99;
        }

        #myTabContent {
            height: 21vh;
            background: #ffffff;
        }
    </style>
{% endblock %}

{% block nav %}
    {# 导航栏 #}
    <nav class="navbar navbar-default" style="border-radius: 0; margin-bottom: 0">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" style="padding: 5px; padding-left: 10px; padding-top: 0;" href="#"><img
                        src="{{ static('img/logo.png') }}" width="160" style="vertical-align: -10px"></a>
                <a class="navbar-brand" href="#"><small>（Beta 1.0）</small></a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a class="text-blue" href="/"><span class="fa fa-home"></span> 系统主页</a></li>
                    <li><a class="text-blue" href="/mul_source/"><span {% if path == 'mul_source' %}
                        style="color: dodgerblue;font-weight: bold"
                    {% endif %}><span class="fa fa-database"></span> 多源数据融合感知</span></a>
                    </li>
                    <li><a class="text-blue" href="/eco_evolution/"><span {% if path == 'eco_evolution' %}
                        style="color: dodgerblue;font-weight: bold"
                    {% endif %}><span class="fa fa-line-chart"></span>
                            社会经济演化预警</span></a></li>
                    <li><a class="text-blue" href="/dpm_warning/"><span {% if path == 'dpm_warning' %}
                        style="color: dodgerblue;font-weight: bold"
                    {% endif %}><span class="fa fa-bell"></span> 社会经济发展分析</span></a>
                    </li>
                    <li><a class="text-blue" href="/lod_warning/"><span {% if path == 'lod_warning' %}
                        style="color: dodgerblue;font-weight: bold"
                    {% endif %}
                    ><span
                            class="fa fa-cubes"></span> 中长期负荷预警</span></a></li>
                    <li><a class="text-blue" href="/res_analysis/"><span {% if path == 'res_analysis' %}
                        style="color: dodgerblue;font-weight: bold"
                    {% endif %}><span class="fa fa-id-card-o"></span>
                        社会求职简历数据可视化</span></a></li>
                </ul>
                <p class="navbar-text navbar-right"><a type="button" style="color: midnightblue" href="#"><span
                        class="fa fa-user-circle"></span> 蒲应明 <small>[注销]</small></a></p>
            </div>
        </div>
    </nav>
{% endblock %}

{% block content %}
    <div>

        {# 主框架 #}

        <div>

            {# 控制栏 #}
            <div class="container-fluid" style="height: 75vh; background: silver">
                <div class="row">
                    <div class="col-md-12" style="height: 75vh; padding: 0">
                        <div class="panel panel-primary">
                            <div class="panel-heading">数据可视化</div>
                            <div class="panel-body" style="height: 75vh">
                                <div class="">
                                    <div class="row">
                                        <div class="col-md-4"
                                             style="background: rgba(245,245,220,0.2); height: 44vh; border: 1px rgba(245,245,220,0.2) solid; ">
                                            <div id="A_container" style="height: 44vh; margin: 0; "></div>
                                        </div>
                                        <div class="col-md-4"
                                             style="background: rgba(245,245,220,0.2); height: 44vh; border: 1px rgba(245,245,220,0.2) solid">
                                            <div id="C_container" style="height: 44vh; margin: 0"></div>
                                        </div>
                                        <div class="col-md-4"
                                             style="background: rgba(245,245,220,0.2); height: 44vh; border: 1px rgba(245,245,220,0.2) solid;">
                                            <select class="form-select" id="date-pick-pie" aria-label="选择日期">
                                                {% for year in years %}
                                                    <option value="{{ year }}">{{ year }}</option>
                                                {% endfor %}
                                            </select>
                                            <div id="B_container" style="height: 44vh; margin: 0"></div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <!-- Part of Prediction. -->
                                        <div class="col-md-8">
                                            <div style="padding-top: 20px">
                                                <div style="border-radius: 9px; border: 1px silver solid; padding: 20px; background: #fffffb; box-shadow:  0 0 5px 5px rgba(0,152,156,0.24)">
                                                    <div class="bs-example bs-example-tabs"
                                                         data-example-id="togglable-tabs">
                                                        <ul id="myTabs" class="nav nav-tabs" role="tablist">
                                                            <li role="presentation" class=""><a href="#model1"
                                                                                                role="tab" id="home-tab"
                                                                                                data-toggle="tab"
                                                                                                aria-controls="home"
                                                                                                aria-expanded="false">统计学习模型</a>
                                                            </li>
                                                            <li role="presentation" class=""><a href="#model2"
                                                                                                role="tab"
                                                                                                id="profile-tab"
                                                                                                data-toggle="tab"
                                                                                                aria-controls="profile"
                                                                                                aria-expanded="false">深度学习模型</a>
                                                            </li>
                                                            <li role="presentation" class=""><a href="#model3"
                                                                                                role="tab"
                                                                                                id="profile-tab"
                                                                                                data-toggle="tab"
                                                                                                aria-controls="profile"
                                                                                                aria-expanded="false">深度学习模型</a>
                                                            </li>
                                                            <li role="presentation" class=""><a href="#model4"
                                                                                                role="tab"
                                                                                                id="profile-tab"
                                                                                                data-toggle="tab"
                                                                                                aria-controls="profile"
                                                                                                aria-expanded="false">深度学习模型</a>
                                                            </li>
                                                            {#                                                            <li role="presentation" class="dropdown active">#}
                                                            {#                                                                <a href="#" id="myTabDrop1" class="dropdown-toggle" data-toggle="dropdown" aria-controls="myTabDrop1-contents" aria-expanded="false">Dropdown#}
                                                            {#                                                                    <span class="caret"></span></a>#}
                                                            {#                                                                <ul class="dropdown-menu" aria-labelledby="myTabDrop1" id="myTabDrop1-contents">#}
                                                            {#                                                                    <li class=""><a href="#dropdown1" role="tab" id="dropdown1-tab" data-toggle="tab" aria-controls="dropdown1" aria-expanded="false">@fat</a>#}
                                                            {#                                                                    </li>#}
                                                            {#                                                                    <li class="active"><a href="#dropdown2" role="tab" id="dropdown2-tab" data-toggle="tab" aria-controls="dropdown2"#}
                                                            {#                                                                                          aria-expanded="true">@mdo</a></li>#}
                                                            {#                                                                </ul>#}
                                                            {#                                                            </li>#}
                                                        </ul>
                                                        <div id="myTabContent" class="tab-content">
                                                            <div role="tabpanel" class="tab-pane fade in" id="model1"
                                                                 aria-labelledby="home-tab">
                                                                1
                                                            </div>
                                                            <div role="tabpanel" class="tab-pane fade" id="model2"
                                                                 aria-labelledby="profile-tab">
                                                                2
                                                            </div>
                                                            <div role="tabpanel" class="tab-pane fade" id="model3"
                                                                 aria-labelledby="profile-tab">
                                                                3
                                                            </div>
                                                            <div role="tabpanel" class="tab-pane fade" id="model4"
                                                                 aria-labelledby="profile-tab">
                                                                4
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4"
                                             style="background: rgba(245,245,220,0.2); border: 1px rgba(245,245,220,0.2) solid; margin-top: 20px">
                                            <div id="D_container" style="height: 27vh; margin: 0"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12" style="height: 16vh">
                        {# 状态栏 #}
                        <div>
                            <div class="container-fluid"
                                 style="color: white; background: rgba(255,255,255,0.1); height: 180px; margin-top: 50px; border-radius: 9px; padding: 10px; border: none">
                                <div class="col-md-4" style="border-left: #a6d4ff solid 1px; height: 12vh">
                                    <h4><span class="fa fa-cubes"></span> 当前模型架构：</h4>
                                    <div style="width: 100%; padding: 12px; height: 60px; background: rgba(255,255,255,0.15); font-weight: 600; line-height: 35px">
                                        模型名称
                                    </div>
                                    <div>
                                        <label style="display: flex; justify-content: space-between">
                                            <span style="padding-top: 18px;padding-left: 10px">选择模型</span>
                                            <select class="form-control"
                                                    style="width: 80%;background: rgba(255,255,255,0.54); margin-top: 10px">
                                                <option>模型1</option>
                                                <option>模型2</option>
                                                <option>模型3</option>
                                                <option>模型3</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3" style="border-left: #a6d4ff solid 1px; height: 12vh">
                                    <h4><span class="fa fa-cogs"></span> 模型超参数：</h4>
                                    <div style="border-radius: 9px; width: 100%; height: 70px; background: rgba(255,255,255,0.2)">

                                    </div>
                                    <div class="row"
                                         style="display: flex; justify-content: space-between; padding-top: 10px">
                                        <button class="btn btn-info" style="width: 95%;">开始预测</button>
                                    </div>
                                </div>
                                <div class="col-md-3" style="border-left: #a6d4ff solid 1px; height: 12vh">
                                    <h4><span class="fa fa-cloud-download"></span> 分析报告：</h4>
                                    <div style="width: 100%; padding: 12px; height: 40px; background: rgba(255,255,255,0.15); font-weight: 600">
                                        <a href="#" style="color: #ffecc7"><i class="fa fa-file-text"></i> 点击下载分析报告</a>
                                    </div>
                                    <div style="padding: 10px; color: #9fc3f5">
                                        当前时间: <span id="current_time" style="padding-left: 10px; color: #f5f0a7"></span>
                                    </div>
                                </div>
                                <div class="col-md-2" style="border-left: #a6d4ff solid 1px; height: 12vh">
                                    <br>
                                    <div>内存 <span id="mem_txt"
                                                  style="padding-left: 10px; color: #f3c6b1; font-weight: 800"></span>
                                    </div>
                                    <div class="progress" style="background: #5b80b2">
                                        <div id="mem_status" class="progress-bar progress-bar-info progress-bar-striped"
                                             role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 20%">
                                        </div>
                                    </div>
                                    <div>CPU <span id="cpu_txt"
                                                   style="padding-left: 10px; color: #bdf3b1; font-weight: 800"></span>
                                    </div>
                                    <div class="progress" style="background: #5b80b2">
                                        <div id="cpu_status" class="progress-bar progress-bar-info progress-bar-striped"
                                             role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 50%">
                                        </div>
                                    </div>
                                    <script>
                                        /*
                                        *   系统状态实时展示： 完毕
                                        * */
                                        setInterval(function () {
                                            $.ajax({
                                                url: '/sys_status/',
                                                dataType: 'JSON',
                                                success: function (sys_data) {
                                                    $('#mem_status').css('width', sys_data['mem_percent'] + '%')
                                                    $('#cpu_status').css('width', sys_data['cpu_percent'] + '%')
                                                    $('#cpu_txt').text(sys_data['cpu_percent'] + '%')
                                                    $('#mem_txt').text(sys_data['mem_percent'] + '%')
                                                }
                                            })
                                        }, 1000)
                                    </script>
                                </div>
                            </div>

                            <div class="progress" style="margin-top: 20px;margin-left: 0; margin-right: 0; padding: 0;
							position: absolute; bottom: -80px; left: 20px; right: 20px; background: #296395">
                                <div id="process" class="progress-bar progress-bar-success progress-bar-striped active"
                                     role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                     style="width: 0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document" style="width: 90%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Modal title</h4>
                    </div>
                    <div class="modal-body" style="height: 100%;">
                        <p>One fine body&hellip;</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default close-btn" data-dismiss="modal">关闭</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="{{ static('plg/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ static('plg/bootstrap-3.4.1-dist/js/bootstrap.js') }}"></script>

    <script type="text/javascript">
        let modalTitle = $('.modal-title')
        let closeBtn = $('.close-btn')
        let modalBody = $('.modal-body')
        let close = $('.close')
        closeBtn.on('click', () => {
            $('.modal').css('display', 'none');
        })
        close.on('click', () => {
            $('.modal').css('display', 'none');
        })
        var dom = document.getElementById("A_container");
        dom.addEventListener('click', () => {
            $('.modal').css('display', 'block').css('background-color', 'rgba(0,0,0, .5)').addClass('in');
            modalTitle.text('主要行业产值随年份变化的折线图')
            modalBody.html('<div id="A_container" style="height: 44vh; margin: 0; "></div>')
            let myChart1 = echarts.init(document.querySelector('.modal-body #A_container'));
            myChart1.setOption(option1);
        })
        var myChart1 = echarts.init(dom);
        var app = {};

        var option1;

        var ROOT_PATH = 'http://127.0.0.1:8000/'

        $.get(
            ROOT_PATH + 'tdata_year',
            function (_rawData) {
                run(JSON.parse(_rawData));
            }
        );

        function run(_rawData) {
            // var countries = ['Australia', 'Canada', 'China', 'Cuba', 'Finland', 'France', 'Germany', 'Iceland', 'India', 'Japan', 'North Korea', 'South Korea', 'New Zealand', 'Norway', 'Poland', 'Russia', 'Turkey', 'United Kingdom', 'United States'];
            const countries = _rawData.names;
            const datasetWithFilters = [];
            const seriesList = [];
            echarts.util.each(countries, function (country) {
                var datasetId = 'dataset_' + country;
                datasetWithFilters.push({
                    id: datasetId,
                    fromDatasetId: 'dataset_raw',
                    transform: {
                        type: 'filter',
                        config: {
                            and: [
                                {dimension: '年份', gte: 2010},
                                {dimension: '类目', '=': country}
                            ]
                        }
                    }
                });
                seriesList.push({
                    type: 'line',
                    datasetId: datasetId,
                    showSymbol: false,
                    name: country,
                    endLabel: {
                        show: true,
                        formatter: function (params) {
                            return params.value[1] + ': ' + params.value[0];
                        }
                    },
                    labelLayout: {
                        moveOverlap: 'shiftY'
                    },
                    emphasis: {
                        focus: 'series'
                    },
                    encode: {
                        x: '年份',
                        y: '产值',
                        label: ['类目', '产值'],
                        itemName: '年份',
                        tooltip: ['产值']
                    }
                });
            });
            option1 = {
                animationDuration: 10000,
                dataset: [
                    {
                        id: 'dataset_raw',
                        source: _rawData.data
                    },
                    ...datasetWithFilters
                ],
                title: {
                    text: '主要行业产值随年份变化的折线图', // 标题部分
                    textStyle: {
                        color: 'red'
                    }
                },
                tooltip: {
                    order: 'valueDesc',
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    nameLocation: 'middle'
                },
                yAxis: {
                    name: '经济产值'
                },
                grid: {
                    right: 0,
                    left: 0,
                },
                series: seriesList
            };
            myChart1.setOption(option1);
        }

        if (option1 && typeof option1 === 'object') {
            myChart1.setOption(option1);
        }

    </script>
    <script type="text/javascript">
        var dom_pie = document.getElementById("B_container");
        const select = document.querySelector('#date-pick-pie')
        dom_pie.addEventListener('click', () => {
            $('.modal').css('display', 'block').css('background-color', 'rgba(0,0,0, .5)').addClass('in');
            modalTitle.text('全国农业产值占比')
            modalBody.html(`<select class="form-select" id="m-date-pick-pie" aria-label="选择日期">
                                                {% for year in years %}
                                                    <option value="{{ year }}">{{ year }}</option>
                                                {% endfor %}
                                            </select><div id="B_container" style="height: 44vh; margin: 0; "></div>`)
            const select = document.querySelector('#m-date-pick-pie')
            let myChart_pie = echarts.init(document.querySelector('.modal-body #B_container'));
            select.addEventListener('change', async (e) => {
                let res = await getOData('tdata_every', select.value)
                data = []
                for (let key in res) {
                    data.push({
                        value: +res[key],
                        name: key
                    })
                }
                let option = myChart_pie.getOption();
                option.series[0].data = data;
                myChart_pie.setOption(option);
            })
            myChart_pie.setOption(option2);
        })
        var myChart_pie = echarts.init(dom_pie);
        var app = {};

        var option2;

        function getOData(path, year) {
            return new Promise(resolve => {
                $.ajax({
                    url: 'http://127.0.0.1:8000/' + path,
                    type: 'get',
                    data: {year},
                    dataType: 'json',
                    success(res) {
                        resolve(res)
                    }
                })
            })
        }

        let data = []
        let res;
        (async function () {
            res = await getOData('tdata_every', select.value)

            for (let key in res) {
                data.push({
                    value: +res[key],
                    name: key
                })
            }
            option2 = {
                title: {
                    text: '全国农业产值占比',
                    textStyle: {
                        color: "red"
                    },
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [
                    {
                        name: 'Access From',
                        type: 'pie',
                        radius: '50%',
                        data,
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            if (option2 && typeof option2 === 'object') {
                myChart_pie.setOption(option2);
            }
        })()

        select.addEventListener('change', async (e) => {
            res = await getOData('tdata_every', select.value)
            data = []
            for (let key in res) {
                data.push({
                    value: +res[key],
                    name: key
                })
            }
            let option = myChart_pie.getOption();
            option.series[0].data = data;
            myChart_pie.setOption(option);
        })

    </script>
    <script type="text/javascript">
        var dom_line = document.getElementById("C_container");
        dom_line.addEventListener('click', () => {
            $('.modal').css('display', 'block').css('background-color', 'rgba(0,0,0, .5)').addClass('in');
            modalTitle.text('全国农业产值占比')
            modalBody.html('<div id="C_container" style="height: 44vh; margin: 0; "></div>')
            let myChart_line = echarts.init(document.querySelector('.modal-body #C_container'));
            myChart_line.setOption(option3);
        })
        var myChart_line = echarts.init(dom_line);
        var app = {};

        var option3;

        var ROOT_PATH = 'http://127.0.0.1:8000/'

        myChart_line.showLoading();
        $.get(
            ROOT_PATH + 'rdata_year',
            function (result) {
                result = JSON.parse(result);
                let lengends = []
                var series = result.data.map(item => {
                    const key = Object.keys(item)[0];
                    lengends.push(key);
                    return {
                        name: key,
                        type: 'bar',
                        data: Object.values(item[key])
                    }
                })
                myChart_line.hideLoading();
                option3 = {
                    title: {
                        text: '各年份按指标归类的经济数据条形图',
                        textStyle: {
                            color: 'red'
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                            label: {
                                show: true
                            }
                        }
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            mark: {show: true},
                            dataView: {show: true, readOnly: false},
                            magicType: {show: true, type: ['line', 'bar']},
                            restore: {show: true},
                            saveAsImage: {show: true}
                        }
                    },
                    calculable: true,
                    legend: {
                        data: lengends,
                        itemGap: 5
                    },
                    grid: {
                        top: '12%',
                        left: '1%',
                        right: '10%',
                        containLabel: true
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: result.names
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '',
                            axisLabel: {
                                formatter: function (a) {
                                    a = +a;
                                    return isFinite(a) ? echarts.format.addCommas(+a / 1000) : '';
                                }
                            }
                        }
                    ],
                    dataZoom: [
                        {
                            show: true,
                            start: 0,
                            end: 100
                        },
                        {
                            type: 'inside',
                            start: 0,
                            end: 100
                        },
                        {
                            show: true,
                            yAxisIndex: 0,
                            filterMode: 'empty',
                            width: 30,
                            height: '80%',
                            showDataShadow: false,
                            left: '93%'
                        }
                    ],
                    series
                };
                myChart_line.setOption(option3);
            }
        );

        if (option3 && typeof option3 === 'object') {
            myChart_line.setOption(option3);
        }

    </script>
    <script type="text/javascript">
        (async function () {
            let res = await new Promise(resolve => {
                $.ajax({
                    url: 'http://127.0.0.1:8000/tdata_total',
                    type: 'get',
                    dataType: 'json',
                    success(res) {
                        resolve(res)
                    }
                })
            });
            let pList = res.names;
            const years = res.years
            let minYear = years[0]
            let maxYear = years[years.length - 1];
            dataMap.dataGDP = dataFormatter(res.data, minYear, maxYear, pList);
            let data = years.map(item => `${item}-01-01`)
            let options = res.data.map((item, index) => {
                let year = Object.keys(item)[0]
                return {
                    title: {
                        text: `各工业生产值按年份变化统计图`, textStyle: {
                            color: 'red'
                        }
                    },
                    series: [
                        {data: dataMap.dataGDP[index][year]},
                        {
                            data: res.lists.map((item, index2) => {
                                return {name: item, value: res.data2[index][year][index2]}
                            })
                        }
                    ]
                }
            });
            option4 = {
                baseOption: {
                    timeline: {
                        axisType: 'category',
                        // realtime: false,
                        // loop: false,
                        autoPlay: true,
                        // currentIndex: 2,
                        playInterval: 500,
                        // controlStyle: {
                        //     position: 'left'
                        // },
                        data,
                        label: {
                            formatter: function (s) {
                                return new Date(s).getFullYear();
                            }
                        }
                    },
                    tooltip: {},
                    legend: {
                        left: 'right',
                        data: ['GDP']
                    },
                    calculable: true,
                    grid: {
                        top: 0,
                        bottom: 100,
                        left: 0,
                        right: 0,
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow',
                                label: {
                                    show: true,
                                    formatter: function (params) {
                                        return params.value.replace('\n', '');
                                    }
                                }
                            }
                        }
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisLabel: {interval: 0},
                            data: pList.map((item, index) => {
                                if (index % 2 !== 0) {
                                    return `\n${item}`
                                } else {
                                    return `${item}`
                                }
                            }),
                            splitLine: {show: false}
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: 'GDP（亿元）'
                        }
                    ],
                    series: [
                        {name: 'GDP', type: 'bar'},
                        {
                            name: 'GDP占比',
                            type: 'pie',
                            center: ['85%', '25%'],
                            radius: '28%',
                            z: 100
                        }
                    ]
                },
                options
            };

            if (option4 && typeof option4 === 'object') {
                myChart_fin.setOption(option4);
            }
        })()
        var dom_fin = document.getElementById("D_container");
        dom_fin.addEventListener('click', () => {
            $('.modal').css('display', 'block').css('background-color', 'rgba(0,0,0, .5)').addClass('in');
            modalTitle.text('全国农业产值占比')
            modalBody.html('<div id="D_container" style="height: 44vh; margin: 0; "></div>')
            let myChart_fin = echarts.init(document.querySelector('.modal-body #D_container'));
            myChart_fin.setOption(option4);
        })
        var myChart_fin = echarts.init(dom_fin);
        var app = {};

        var option4;


        var dataMap = {};

        function dataFormatter(obj, maxYear, minYear, pList) {
            var temp;
            for (var year = minYear; year <= maxYear; year++) {
                var max = 0;
                temp = obj[year];
                for (var i = 0, l = temp.length; i < l; i++) {
                    max = Math.max(max, temp[i]);
                    obj[year][i] = {
                        name: pList[i],
                        value: temp[i]
                    };
                }
                obj[year + 'max'] = Math.floor(max / 100) * 100;
            }
            return obj;
        }

    </script>
{% endblock %}